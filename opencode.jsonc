{
  "$schema": "https://opencode.ai/config.json",
  "theme": "opencode",
  "share": "disabled",
  // "model": "anthropic/claude-sonnet-4-5-20250929",
  "model": "anthropic/claude-opus-4-5-20251101",
  "small_model": "anthropic/claude-haiku-4-5-20251001",
  "instructions": ["OPENCODE.md"],

  // MCP Servers
  "mcp": {
    // Tavily - Real-time web search, extract, map & crawl
    // Requires TAVILY_API_KEY environment variable
    "tavily": {
      "type": "remote",
      "url": "https://mcp.tavily.com/mcp/",
      "oauth": false,
      "headers": {
        "Authorization": "Bearer {env:TAVILY_API_KEY}"
      }
    }
  },

  // Disable MCP tools globally to save context - enable per-agent as needed
  "tools": {
    "tavily_*": false
  },

  "permission": {
    "edit": "ask",
    "bash": "ask",
    "read": {
      "*": "allow",

      // Environment files
      "*.env": "deny",
      "*.env.*": "deny",
      "*.env.example": "allow",
      ".secrets": "deny",
      "secrets.yaml": "deny",
      "secrets.yml": "deny",
      "**/secrets/**": "deny",

      // SOPS encrypted files
      "*.sops.yaml": "deny",
      "*.sops.yml": "deny",
      "**/*.sops.yaml": "deny",
      "**/*.sops.yml": "deny",
      "**/*.enc": "deny",
      ".sops.yaml": "deny",
      ".decrypted~*": "deny",

      // SSH keys and certificates
      "*.key": "deny",
      "*.pem": "deny",
      "*.crt": "deny",
      "*.cer": "deny",
      "*.p12": "deny",
      "*.pfx": "deny",
      "id_rsa": "deny",
      "id_rsa.pub": "deny",
      "id_ed25519": "deny",
      "id_ed25519.pub": "deny",
      "**/.ssh/**": "deny",

      // Age/GPG encryption keys
      "keys.txt": "deny",
      "age.key": "deny",
      "*.age": "deny",
      "*.gpg": "deny",
      "*.asc": "deny",
      "*.pgp": "deny",

      // Kubeconfig (contains cluster credentials)
      "**/kubeconfig": "deny",
      "kubeconfig.*": "deny",
      "*.kubeconfig": "deny",

      // Ansible Vault
      "ansible-vault.*": "deny",

      // Terraform (state contains secrets)
      "*.tfstate": "deny",
      "*.tfstate.*": "deny",
      "terraform.tfstate*": "deny",
      "terraform.tfvars": "deny",
      "terraform.tfvars.json": "deny",

      // Private directories
      ".private/**": "deny"
    }
  },
  "agent": {
    // Session Management - use Haiku for lightweight context loading
    "session-initializer": {
      "description": "Bootstraps new OpenCode sessions by loading critical context, permissions, and previous work. Invoke at EVERY session start.",
      "model": "anthropic/claude-haiku-4-5-20251001",
      "temperature": 0.2,
      "permission": {
        "edit": "allow",
        "write": "allow"
      }
    },
    "session-closer": {
      "description": "Wraps up sessions by updating CURRENT.md with accomplishments, decisions, and next steps. Invoke when user signals session end or work complete.",
      "model": "anthropic/claude-haiku-4-5-20251001",
      "temperature": 0.2,
      "permission": {
        "edit": "allow",
        "write": "allow"
      }
    },

    // Code Review & Quality - low temperature for consistent, deterministic reviews
    "pre-commit-reviewer": {
      "description": "Reviews staged changes for security vulnerabilities, secrets, code quality, and linting compliance. Invoke before commits, when user requests code review, security scan, or quality check. Has 200+ secret detection patterns.",
      "temperature": 0.1
    },
    "security-reviewer": {
      "description": "Scans for secrets, credentials, API keys, and infrastructure disclosure before public repository commits. Invoke when committing to public repos, reviewing documentation for sensitive info, or user requests security review.",
      "temperature": 0.1
    },

    // Analyzers - balanced temperature for thorough analysis
    "history-analyzer": {
      "description": "Extracts context from past sessions for historical decisions and patterns. Invoke when user asks about previous work, references past decisions, or needs context from session history.",
      "temperature": 0.2
    },

    // Infrastructure - read-only analysis, deny edits
    "commit-orchestrator": {
      "description": "Orchestrates complex git commit workflows with security validation, conventional commit messages, and logical grouping. Invoke for multi-file commits, when user requests commit help, or needs commit message generation.",
      "temperature": 0.2,
      "permission": {
        "edit": "deny",
        "bash": "ask"
      }
    },

    // Documentation - slightly higher temperature for creative writing, allow bash for mkdocs build
    "docs-maintainer": {
      "description": "Creates and updates MkDocs documentation with strict build validation and navigation updates. Invoke for ANY documentation work, including creating docs, updating existing pages, fixing broken links, or validating mkdocs builds.",
      "temperature": 0.3,
      "permission": {
        "edit": "ask",
        "bash": "allow"
      }
    },

    // Meta-Agents - Opus for complex agent design, Haiku for simple optimization
    "agent-builder": {
      "description": "Meta-agent that designs and creates new OpenCode agents with proper frontmatter, descriptions, and tool configurations. Invoke to expand agent ecosystem or create specialized workflow agents.",
      "temperature": 0.3
    },
    "ecosystem-analyzer": {
      "description": "Performs comprehensive audit of OpenCode setup including agents, permissions, and workflow integration. Invoke for periodic health checks or when optimizing OpenCode effectiveness.",
      "temperature": 0.2
    },
    "md-optimizer": {
      "description": "Optimizes OPENCODE.md structure, orchestration clarity, and delegation patterns. Invoke to improve agent coordination messaging.",
      "model": "anthropic/claude-haiku-4-5-20251001",
      "temperature": 0.3
    },

    // Web Research - uses Tavily MCP for real-time web search
    "web-researcher": {
      "description": "Performs real-time web searches using Tavily. Invoke when current information is needed: documentation lookups, version checks, troubleshooting, or researching tools/technologies. Returns search results, can extract content from URLs, map websites, and crawl pages.",
      "model": "anthropic/claude-haiku-4-5-20251001",
      "temperature": 0.1,
      "tools": {
        "tavily_*": true
      }
    }
  }
}
